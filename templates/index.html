{% extends "base.html" %}

{% block jsonld %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "name": "{{ site_name }}",
      "url": "{{ site_url }}/",
      "description": "{{ site_description }}"
    },
    {
      "@type": "Organization",
      "name": "{{ site_name }}",
      "url": "{{ site_url }}/",
      "description": "{{ site_description }}"
    }
  ]
}
</script>
{% endblock %}

{% block nav_extra %}
  <button id="view-toggle" class="view-toggle" onclick="toggleView()">Agent View</button>
{% endblock %}

{% block content %}

<div id="human-view">
{% for article in articles %}
<article>
  <h2>
    <a href="{{ base_url }}/articles/{{ article.date[:4] }}/{{ article.date[5:7] }}/{{ article.date[8:10] }}/{{ article.slug }}.html">{{ article.title }}</a>
    {% if article.content_type == 'synthesis' %}<span class="badge badge-synthesis">Synthesis</span>{% endif %}
  </h2>
  <div class="meta">
    {{ article.date[:10] }} &middot; {{ article.category }}
    {% if article.sentiment and article.sentiment != 'neutral' %}
      <span class="sentiment sentiment-{{ article.sentiment }}">{{ article.sentiment }}</span>
    {% endif %}
    {% for tag in article.tags %}<span class="tag">{{ tag }}</span>{% endfor %}
  </div>
  <p class="summary">{{ article.summary }}</p>
</article>
{% endfor %}
</div>

<div id="agent-view" class="agent-view" style="display: none;">
  <div class="agent-endpoints">
    <h2>API Endpoints</h2>
    <div class="endpoint-grid">
      <a href="{{ base_url }}/index.json" class="endpoint-card">
        <span class="endpoint-label">JSON API</span>
        <code>/index.json</code>
        <span class="endpoint-desc">Structured article index with full metadata</span>
      </a>
      <a href="{{ base_url }}/v1/articles.json" class="endpoint-card">
        <span class="endpoint-label">v1 API</span>
        <code>/v1/articles.json</code>
        <span class="endpoint-desc">Versioned stable endpoint</span>
      </a>
      <a href="{{ base_url }}/api/today.json" class="endpoint-card">
        <span class="endpoint-label">Today</span>
        <code>/api/today.json</code>
        <span class="endpoint-desc">Articles published today (UTC)</span>
      </a>
      <a href="{{ base_url }}/api/category/" class="endpoint-card">
        <span class="endpoint-label">By Category</span>
        <code>/api/category/{name}.json</code>
        <span class="endpoint-desc">Per-category filtered articles</span>
      </a>
      <a href="{{ base_url }}/feed.xml" class="endpoint-card">
        <span class="endpoint-label">RSS 2.0</span>
        <code>/feed.xml</code>
        <span class="endpoint-desc">Standard syndication feed</span>
      </a>
      <a href="{{ base_url }}/llms.txt" class="endpoint-card">
        <span class="endpoint-label">LLMs.txt</span>
        <code>/llms.txt</code>
        <span class="endpoint-desc">Agent discovery document</span>
      </a>
      <a href="{{ base_url }}/llms-full.txt" class="endpoint-card">
        <span class="endpoint-label">Full Content</span>
        <code>/llms-full.txt</code>
        <span class="endpoint-desc">Complete article text for LLMs</span>
      </a>
      <a href="{{ base_url }}/sitemap.xml" class="endpoint-card">
        <span class="endpoint-label">Sitemap</span>
        <code>/sitemap.xml</code>
        <span class="endpoint-desc">XML sitemap for crawlers</span>
      </a>
      <a href="{{ base_url }}/.well-known/ai-plugin.json" class="endpoint-card">
        <span class="endpoint-label">AI Plugin</span>
        <code>/.well-known/ai-plugin.json</code>
        <span class="endpoint-desc">Agent plugin manifest</span>
      </a>
    </div>
  </div>

  <h2>Articles</h2>
  <div id="agent-articles"></div>
</div>

<script id="articles-data" type="application/json">
[
  {% for article in articles %}
  {
    "title": {{ article.title | tojson }},
    "slug": "{{ article.slug }}",
    "date": "{{ article.date }}",
    "category": "{{ article.category }}",
    "content_type": "{{ article.content_type }}",
    "sentiment": "{{ article.sentiment }}",
    "impact": "{{ article.impact }}",
    "tags": {{ article.tags | tojson }},
    "reporter": "{{ article.reporter }}",
    "summary": {{ article.summary | tojson }},
    "sources": {{ article.sources | tojson }},
    "url_html": "{{ site_url }}/articles/{{ article.date[:4] }}/{{ article.date[5:7] }}/{{ article.date[8:10] }}/{{ article.slug }}.html",
    "url_md": "{{ site_url }}/articles/{{ article.date[:4] }}/{{ article.date[5:7] }}/{{ article.date[8:10] }}/{{ article.slug }}.md"
  }{% if not loop.last %},{% endif %}
  {% endfor %}
]
</script>

{% endblock %}

{% block scripts %}
<script src="{{ base_url }}/toggle.js"></script>
{% endblock %}
